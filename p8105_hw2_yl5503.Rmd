---
title: "P8105 HW 2"
author: "Yuki Low yl5503"
output: github_document
---

Loading necessary libraries
```{r, message = FALSE}
library(tidyverse)
library(haven)
library(readxl)
library(janitor)
library(dplyr)
library(tidyr)
library(stringr)
```

Question 1: 
```{r, message = FALSE}
pols_df = 
  read_csv("./data/pols-month.csv") %>%
  janitor::clean_names()


pols_df <- pols_df %>% 
  separate(
    mon,
    into = c('year', 'month', 'day'), 
    sep = "-", 
    remove = TRUE) %>% 
  mutate(
    month = month.abb[as.numeric(month)], 
    president = case_when(prez_gop == 1 & prez_dem == 0 ~ "rep",
                          prez_dem == 1 & prez_gop == 0 ~ "dem")) %>%
    select(-prez_gop, -gov_gop, -day)

```

```{r , message = FALSE}
snp_df = 
  read_csv("./data/snp.csv") %>%
  janitor::clean_names()

snp_df <- snp_df %>% 
  separate(
    date, 
    into = c('month','day','year'),
    sep = '/',
    remove = TRUE) %>% 
  mutate(
    month = month.abb[as.numeric(month)]) %>%
  select(-day) %>% 
  select(year, month, close) %>% 
  mutate(year = str_c("19", year))

```

```{r}
df <- left_join(pols_df,snp_df)
df <- df %>% 
  mutate(year = as.double(year))
```

```{r, message = FALSE}
unemploy_df = 
  read_csv("./data/unemployment.csv") %>%
  janitor::clean_names()

unemploy_df <- unemploy_df %>% 
  pivot_longer(cols = 2:13, names_to = "month", values_to = "unemployment") %>% 
  mutate(month = str_to_title(month))

head(unemploy_df)
```

```{r, message = FALSE}
final_df <- left_join(df, unemploy_df)
str(final_df)
```

```{r, message = FALSE}
mrtrashwheel_df = 
  read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel") %>%
  janitor::clean_names()

mrtrashwheel_df <-
  mrtrashwheel_df %>% 
  drop_na(dumpster) %>%
  select(dumpster:homes_powered) %>% 
  mutate(homes_powered = weight_tons * 500 / 30) %>% 
  mutate(name = "Mr Trash Wheel") %>% 
  mutate(year = as.numeric(year))

proftrashwheel_df = 
  read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel") %>%
  janitor::clean_names()

proftrashwheel_df <- 
  proftrashwheel_df %>% 
  drop_na(dumpster) %>% 
  mutate(homes_powered = weight_tons * 500 / 30) %>% 
  mutate(name = "Professor Trash Wheel") %>% 
  mutate(year = as.numeric(year))

proftrashwheel_df

gwynnda_df = 
  read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel") %>%
  janitor::clean_names()

gwynnda_df <- 
  gwynnda_df %>% 
  mutate(grocery_bags = plastic_bags) %>% 
  select(!plastic_bags) %>% 
  mutate(name = "Gwynnda Trash Wheel")

gwynnda_df

mr_and_prof <- bind_rows(mrtrashwheel_df, proftrashwheel_df)
combined_df <- bind_rows(mr_and_prof, gwynnda_df)

combined_df
```

The number of observations in the resulting dataset after merging the data from Mr. Trash Wheel, Professor Trash Wheel and Gwynnda Trash Wheel was `r nrow(combined_df)`. The number of variables from the resulting dataset was `r ncol(combined_df)`. This resulting dataset tells you the weight and volume of trash collected by one of the three trash wheels (either Mr. Trash Wheel, Professor Trash Wheel or Gwynnda Trash Wheel). It also tells us how much of each material was found (e.g. plastic bottles, polysterene, cigarette butts, etc.). The total weight of trash collected by Professor Trash Wheel was `r sum(proftrashwheel_df$weight_tons)` tons. The total number of cigarette butts collected by Gwynnda in July of 2021 was `r sum(filter(gwynnda_df,year == "2021" & month == "July")$cigarette_butts)`

```{r}
baseline_df = 
  read_csv("./data/MCI_baseline.csv") %>%
  janitor::clean_names()

baseline_df <- baseline_df %>% 
  slice(-1) %>%
  mutate(x1_male_0_female = ifelse(x1_male_0_female == "1", "male", "female")) %>% 
  mutate(x1_apoe4_carrier_0_apoe4_non_carrier = ifelse(x1_apoe4_carrier_0_apoe4_non_carrier == "1", "yes", "no")) %>% 
  mutate_all(~ ifelse(. == ".", NA, .))

new_column_names <- c("ID", "baseline_age", "sex", "years_of_education", "apoe_carrier", "onset_age")  # Replace ... with your new column names

colnames(baseline_df) <- new_column_names

baseline_df <- baseline_df %>% 
  mutate(sex = as.factor(sex), baseline_age = as.numeric(baseline_age), years_of_education = as.numeric(years_of_education), apoe_carrier = as.factor(apoe_carrier), onset_age = as.numeric(onset_age))

baseline_df

apoe_female_prop <- count(filter(baseline_df, sex == 'female' & apoe_carrier == 'yes')) / count(filter(baseline_df, sex == 'female'))


```

`r nrow(baseline_df)` participants were recruited and `r count(filter(baseline_df,!is.na(onset_age)))` developed MCI. The mean baseline age is `r mean(baseline_df$baseline_age)` years. The proportion of women in the study who were APOE4 carriers is `r apoe_female_prop`


